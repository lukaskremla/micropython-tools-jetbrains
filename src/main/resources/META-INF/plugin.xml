<idea-plugin url="https://github.com/lukaskremla/micropython-tools-jetbrains">
    <name>MicroPython Tools</name>
    <vendor>Lukas Kremla</vendor>
    <id>micropython-tools-jetbrains</id>

    <version>SNAPSHOT</version>
    <product-descriptor code="PMPYTOOLS" release-date="20251017" release-version="07" optional="true"/>

    <change-notes><![CDATA[
        <h3>0.7.0 - 17-10-2025</h3>
        <ul>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <br>
        <p>Previous versions can be found in <a href="https://github.com/lukaskremla/micropython-tools-jetbrains/blob/main/CHANGES.md">CHANGES.md</a> on GitHub</p>
    ]]></change-notes>

    <description><![CDATA[
        <p>Adds MicroPython support to JetBrains IDEs.</p>
        <br>
        <p>Main features:</p>
        <ul>
          <li>Upload and synchronize files with MicroPython devices (Serial and WebREPL supported)</li>
          <li>File System view with drag and drop, create/rename/delete, copy/cut/paste, and download</li>
          <li>Stub package manager for <a href="https://github.com/Josverl/micropython-stubs">MicroPython stubs</a></li>
          <li>On-device file editing (read-only by default, editable with save-to-device option)</li>
          <li>REPL integration with reset, interrupt, and clear actions</li>
          <li>Run configurations for Project, Selected Sources Roots, and Custom Paths</li>
          <li>Mounted volume support (e.g. SD cards)</li>
        </ul>
        <br>
        <p>Documentation, usage tips, and issue tracker are available on
        <a href="https://github.com/lukaskremla/micropython-tools-jetbrains">GitHub</a>.</p>
]]></description>

    <dependencies>
        <plugin id="com.intellij.modules.lang"/>
        <plugin id="com.intellij.modules.python"/>
        <plugin id="com.intellij.modules.platform"/>
        <plugin id="org.jetbrains.plugins.terminal"/>
    </dependencies>

    <idea-version since-build="243"/>

    <resource-bundle>localization.MpyBundle</resource-bundle>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Settings -->
        <projectConfigurable groupId="language"
                             id="dev.micropythontools.configurable"
                             key="configurable.name"
                             bundle="localization.MpyBundle"
                             instance="dev.micropythontools.settings.MpyConfigurable"/>

        <!-- JPS plugin for MpyJpsModelSerializerExtension -->
        <jps.plugin/>

        <!-- Inspections -->
        <!--suppress PluginXmlCapitalization -->
        <localInspection language="Python"
                         key="inspection.stubs.name"
                         groupKey="inspection.group.name"
                         bundle="localization.MpyBundle"
                         enabledByDefault="true"
                         implementationClass="dev.micropythontools.inspections.MpyStubPackageInspection"/>

        <!-- Inspections -->
        <!--suppress PluginXmlCapitalization -->
        <localInspection language="Python"
                         key="inspection.python.interpreter.name"
                         groupKey="inspection.group.name"
                         bundle="localization.MpyBundle"
                         enabledByDefault="true"
                         implementationClass="dev.micropythontools.inspections.MpyPythonInspection"/>

        <!-- Notifications -->
        <!--suppress PluginXmlCapitalization -->
        <notificationGroup displayType="BALLOON"
                           id="dev.micropythontools.notification.group"
                           key="notification.group.name"
                           bundle="localization.MpyBundle"/>

        <!-- Run configurations -->
        <configurationType implementation="dev.micropythontools.run.MpyRunConfType"/>

        <!-- UI elements -->
        <toolWindow factoryClass="dev.micropythontools.ui.MpyToolWindow"
                    id="MicroPython Tools"
                    anchor="bottom"
                    canCloseContents="false"/>

        <!-- Source roots -->
        <projectStructure.sourceRootEditHandler
                implementation="dev.micropythontools.sourceroots.MpyModuleMpySourceRootEditHandler"/>

        <!-- Startup tasks -->
        <postStartupActivity implementation="dev.micropythontools.startup.MpyConfigurationMigrationActivity"/>

        <!-- Editor notifications -->
        <editorNotificationProvider implementation="dev.micropythontools.editor.MpyEditorNotificationProvider"/>

        <projectService
                serviceInterface="dev.micropythontools.freemium.MpyProServiceInterface"
                serviceImplementation="dev.micropythontools.freemium.MpyProServiceFreeImpl"/>
    </extensions>

    <applicationListeners>
        <listener topic="com.intellij.openapi.actionSystem.ex.AnActionListener"
                  class="dev.micropythontools.listeners.MpySaveKeyListener"/>
    </applicationListeners>

    <actions>
        <!-- FS toolbar -->
        <group id="dev.micropythontools.fs.FSToolbarGroup">
            <action id="dev.micropythontools.repl.MpyConnectAction"
                    class="dev.micropythontools.actions.MpyConnectAction"/>
            <action id="dev.micropythontools.repl.MpyDisconnectAction"
                    class="dev.micropythontools.actions.MpyDisconnectAction">
                <keyboard-shortcut first-keystroke="control CLOSE_BRACKET" keymap="$default"/>
            </action>
            <action id="dev.micropythontools.repl.MpyConnectionSelectorAction"
                    class="dev.micropythontools.actions.MpyConnectionSelectorAction"/>
            <action id="dev.micropythontools.fs.MpyRefreshAction"
                    class="dev.micropythontools.actions.MpyRefreshAction">
                <keyboard-shortcut first-keystroke="control R" keymap="$default"/>
            </action>
            <action id="dev.micropythontools.fs.MpyDownloadAction"
                    class="dev.micropythontools.actions.MpyDownloadAction"/>
            <action id="dev.micropythontools.fs.MpyDeleteAction"
                    class="dev.micropythontools.actions.MpyDeleteAction"
                    use-shortcut-of="$Delete"/>
            <action id="dev.micropythontools.repl.MpyOpenSettingsAction"
                    class="dev.micropythontools.actions.MpyOpenSettingsAction"/>
            <action id="dev.micropythontools.repl.MpyAutoClearAction"
                    class="dev.micropythontools.actions.MpyAutoClearAction"/>
        </group>

        <!-- FS context menu -->
        <group id="dev.micropythontools.fs.FSContextMenuGroup">
            <group id="dev.micropythontools.fs.MpyNewActionGroup"
                   class="dev.micropythontools.actions.MpyNewActionGroup">
            </group>

            <separator/>

            <reference ref="$Cut"/>
            <reference ref="$Copy"/>
            <group id="dev.micropythontools.fs.MpyCopyPathActionGroup"
                   class="dev.micropythontools.actions.MpyCopyPathActionGroup">
            </group>

            <reference ref="$Paste"/>

            <separator/>

            <action id="dev.micropythontools.fs.MpyRenameAction"
                    class="dev.micropythontools.actions.MpyRenameAction"
                    use-shortcut-of="RenameElement"/>

            <separator/>

            <action id="dev.micropythontools.fs.MpyOpenFileAction"
                    class="dev.micropythontools.actions.MpyOpenFileAction"/>
            <reference ref="dev.micropythontools.fs.MpyRefreshAction"/>
            <reference ref="dev.micropythontools.fs.MpyDownloadAction"/>

            <separator/>

            <reference ref="dev.micropythontools.fs.MpyDeleteAction"/>
        </group>

        <!-- REPL toolbar -->
        <group id="dev.micropythontools.repl.ReplToolbarGroup">
            <reference ref="dev.micropythontools.repl.MpyConnectAction"/>
            <reference ref="dev.micropythontools.repl.MpyDisconnectAction"/>
            <reference ref="dev.micropythontools.repl.MpyConnectionSelectorAction"/>
            <action id="dev.micropythontools.repl.MpySoftResetAction"
                    class="dev.micropythontools.actions.MpySoftResetAction">
                <keyboard-shortcut first-keystroke="control D" keymap="$default"/>
            </action>
            <action id="dev.micropythontools.repl.MpyInterruptAction"
                    class="dev.micropythontools.actions.MpyInterruptAction"/>
            <action id="dev.micropythontools.repl.MpyClearReplAction"
                    class="dev.micropythontools.actions.MpyClearReplAction"/>
            <reference ref="dev.micropythontools.repl.MpyOpenSettingsAction"/>
            <reference ref="dev.micropythontools.repl.MpyAutoClearAction"/>
        </group>

        <!-- Upload actions -->
        <group id="dev.micropythontools.repl.MpyUploadActionGroup"
               class="dev.micropythontools.actions.MpyUploadActionGroup">
            <add-to-group group-id="EditorPopupMenu" anchor="before" relative-to-action="ExecuteInPyConsoleAction"/>
            <add-to-group group-id="EditorTabPopupMenu" anchor="last"/>
            <add-to-group group-id="ProjectViewPopupMenuSettingsGroup" anchor="last"/>
        </group>

        <action id="dev.micropythontools.repl.MpyUploadProjectAction"
                class="dev.micropythontools.actions.MpyUploadProjectAction">
            <add-to-group group-id="ProjectViewPopupMenuSettingsGroup" anchor="last"/>
        </action>

        <action id="dev.micropythontools.repl.MpyExecuteFileInReplAction"
                class="dev.micropythontools.actions.MpyExecuteFileInReplAction">
            <add-to-group group-id="EditorPopupMenu"
                          anchor="before"
                          relative-to-action="dev.micropythontools.repl.MpyUploadActionGroup"/>
            <add-to-group group-id="EditorTabPopupMenu"
                          anchor="before"
                          relative-to-action="dev.micropythontools.repl.MpyUploadActionGroup"/>
            <add-to-group group-id="ProjectViewPopupMenuSettingsGroup"
                          anchor="before"
                          relative-to-action="dev.micropythontools.repl.MpyUploadActionGroup"/>
        </action>

        <action id="dev.micropythontools.repl.MpyExecuteFragmentInReplAction"
                class="dev.micropythontools.actions.MpyExecuteFragmentInReplAction">
            <add-to-group group-id="EditorPopupMenu"
                          anchor="before"
                          relative-to-action="dev.micropythontools.repl.MpyExecuteFileInReplAction"/>
        </action>

        <!-- Source root marking -->
        <group id="dev.micropythontools.sourceroots.MarkMpySourceRootGroup">
            <action id="dev.micropythontools.sourceroots.MarkMpySourceRootAction"
                    class="dev.micropythontools.sourceroots.MarkMpySourceRootAction"/>
            <add-to-group group-id="MarkRootGroup"/>
        </group>
    </actions>
</idea-plugin>